<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.11: http://docutils.sourceforge.net/" />
<title>ECE 429 course project</title>
<meta name="authors" content="Dan White and contributors" />
<meta name="date" content="2016-04-11 00:45" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/*
*   math2html: convert LaTeX equations to HTML output.
*
*   Copyright (C) 2009,2010 Alex Fern√°ndez
*
*   Released under the terms of the `2-Clause BSD license'_, in short:
*   Copying and distribution of this file, with or without modification,
*   are permitted in any medium without royalty provided the copyright
*   notice and this notice are preserved.
*   This file is offered as-is, without any warranty.
*
* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause
*
*   Based on eLyXer: convert LyX source files to HTML output.
*   http://elyxer.nongnu.org/
*/
/* --end--
* CSS file for LaTeX formulas.
*/

/* Formulas */
.formula {
	text-align: center;
	font-family: "Droid Serif", "DejaVu Serif", "STIX", serif;
	margin: 1.2em 0;
}
span.formula {
	white-space: nowrap;
}
div.formula {
	padding: 0.5ex;
	margin-left: auto;
	margin-right: auto;
}

/* Basic features */
a.eqnumber {
	display: inline-block;
	float: right;
	clear: right;
	font-weight: bold;
}
span.unknown {
	color: #800000;
}
span.ignored, span.arraydef {
	display: none;
}
.formula i {
	letter-spacing: 0.1ex;
}

/* Alignment */
.align-left, .align-l {
	text-align: left;
}
.align-right, .align-r {
	text-align: right;
}
.align-center, .align-c {
	text-align: center;
}

/* Structures */
span.overline, span.bar {
	text-decoration: overline;
}
.fraction, .fullfraction {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
}
.fraction .fraction {
	font-size: 80%;
	line-height: 100%;
}
span.numerator {
	display: block;
}
span.denominator {
	display: block;
	padding: 0ex;
	border-top: thin solid;
}
sup.numerator, sup.unit {
	font-size: 70%;
	vertical-align: 80%;
}
sub.denominator, sub.unit {
	font-size: 70%;
	vertical-align: -20%;
}
span.sqrt {
	display: inline-block;
	vertical-align: middle;
	padding: 0.1ex;
}
sup.root {
	font-size: 70%;
	position: relative;
	left: 1.4ex;
}
span.radical {
	display: inline-block;
	padding: 0ex;
	font-size: 150%;
	vertical-align: top;
}
span.root {
	display: inline-block;
	border-top: thin solid;
	padding: 0ex;
	vertical-align: middle;
}
span.symbol {
	line-height: 125%;
	font-size: 125%;
}
span.bigsymbol {
	line-height: 150%;
	font-size: 150%;
}
span.largesymbol {
	font-size: 175%;
}
span.hugesymbol {
	font-size: 200%;
}
span.scripts {
	display: inline-table;
	vertical-align: middle;
}
.script {
	display: table-row;
	text-align: left;
	line-height: 150%;
}
span.limits {
	display: inline-table;
	vertical-align: middle;
}
.limit {
	display: table-row;
	line-height: 99%;
}
sup.limit, sub.limit {
	line-height: 100%;
}
span.symbolover {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 100%;
	bottom: 0.5em;
	width: 0px;
}
span.withsymbol {
	display: inline-block;
}
span.symbolunder {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 80%;
	top: 0.3em;
	width: 0px;
}

/* Environments */
span.array, span.bracketcases, span.binomial, span.environment {
	display: inline-table;
	text-align: center;
	border-collapse: collapse;
	margin: 0em;
	vertical-align: middle;
}
span.arrayrow, span.binomrow {
	display: table-row;
	padding: 0ex;
	border: 0ex;
}
span.arraycell, span.bracket, span.case, span.binomcell, span.environmentcell {
	display: table-cell;
	padding: 0ex 0.2ex;
	line-height: 99%;
	border: 0ex;
}
/*
* CSS file for LaTeX formulas, extra stuff:
* binomials, vertical braces, stackrel, fonts and colors.
*/

/* Inline binomials */
span.binom {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
	font-size: 80%;
}
span.binomstack {
	display: block;
	padding: 0em;
}

/* Over- and underbraces */
span.overbrace {
	border-top: 2pt solid;
}
span.underbrace {
	border-bottom: 2pt solid;
}

/* Stackrel */
span.stackrel {
	display: inline-block;
	text-align: center;
}
span.upstackrel {
	display: block;
	padding: 0em;
	font-size: 80%;
	line-height: 64%;
	position: relative;
	top: 0.15em;

}
span.downstackrel {
	display: block;
	vertical-align: bottom;
	padding: 0em;
}

/* Fonts */
span.mathsf, span.textsf {
	font-style: normal;
	font-family: sans-serif;
}
span.mathrm, span.textrm {
	font-style: normal;
	font-family: serif;
}
span.text, span.textnormal {
	font-style: normal;
}
span.textipa {
	color: #008080;
}
span.fraktur {
	font-family: "Lucida Blackletter", eufm10, blackletter;
}
span.blackboard {
	font-family: Blackboard, msbm10, serif;
}
span.scriptfont {
	font-family: "Monotype Corsiva", "Apple Chancery", "URW Chancery L", cursive;
	font-style: italic;
}

/* Colors */
span.colorbox {
	display: inline-block;
	padding: 5px;
}
span.fbox {
	display: inline-block;
	border: thin solid black;
	padding: 2px;
}
span.boxed, span.framebox {
	display: inline-block;
	border: thin solid black;
	padding: 5px;
}


</style>
</head>
<body>
<div class="document" id="ece-429-course-project">
<h1 class="title">ECE 429 course project</h1>
<h2 class="subtitle" id="backscatter-rfid-chip">Backscatter RFID Chip</h2>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Authors:</th>
<td>Dan White and contributors</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2016-04-11 00:45</td></tr>
<tr><th class="docinfo-name">Version:</th>
<td>v0.1-28-g919959d</td></tr>
</tbody>
</table>
<!-- rubber: clean specifications.out -->
<!-- \DeclareGraphicsExtensions{.pdf,.png,.jpg} -->
<script src="http://wavedrom.com/skins/default.js" type="text/javascript"></script>
<script src="http://wavedrom.com/wavedrom.min.js" type="text/javascript"></script>
<body onload="WaveDrom.ProcessAll()">
<meta http-equiv="refresh" content="10"> // TEMPORARY<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id2">1&nbsp;&nbsp;&nbsp;Introduction</a><ul class="auto-toc">
<li><a class="reference internal" href="#terminology" id="id3">1.1&nbsp;&nbsp;&nbsp;Terminology</a></li>
<li><a class="reference internal" href="#radio-frequency-identification" id="id4">1.2&nbsp;&nbsp;&nbsp;Radio-frequency identification</a></li>
<li><a class="reference internal" href="#synchronous-serial-communication" id="id5">1.3&nbsp;&nbsp;&nbsp;Synchronous Serial Communication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#project-specifications" id="id6">2&nbsp;&nbsp;&nbsp;Project Specifications</a><ul class="auto-toc">
<li><a class="reference internal" href="#processor-interface-specification" id="id7">2.1&nbsp;&nbsp;&nbsp;Processor interface specification</a><ul class="auto-toc">
<li><a class="reference internal" href="#protocol-references" id="id8">2.1.1&nbsp;&nbsp;&nbsp;Protocol references</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subsystem-interconnection" id="id9">2.2&nbsp;&nbsp;&nbsp;Subsystem Interconnection</a></li>
<li><a class="reference internal" href="#data-transmit-controller" id="id10">2.3&nbsp;&nbsp;&nbsp;Data Transmit Controller</a></li>
<li><a class="reference internal" href="#numerically-controlled-oscillator-nco" id="id11">2.4&nbsp;&nbsp;&nbsp;Numerically-controlled oscillator (NCO)</a></li>
<li><a class="reference internal" href="#symbol-rate-clock-generator" id="id12">2.5&nbsp;&nbsp;&nbsp;Symbol rate clock generator</a></li>
<li><a class="reference internal" href="#frequency-control-word-multiplexer" id="id13">2.6&nbsp;&nbsp;&nbsp;Frequency Control Word multiplexer</a></li>
<li><a class="reference internal" href="#switch-mapper" id="id14">2.7&nbsp;&nbsp;&nbsp;Switch mapper</a></li>
<li><a class="reference internal" href="#antenna-switches" id="id15">2.8&nbsp;&nbsp;&nbsp;Antenna switches</a></li>
<li><a class="reference internal" href="#charge-pump" id="id16">2.9&nbsp;&nbsp;&nbsp;Charge pump</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id2">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<div class="section" id="terminology">
<h2><a class="toc-backref" href="#id3">1.1&nbsp;&nbsp;&nbsp;Terminology</a></h2>
<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,  &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be interpreted as described in <a class="citation-reference" href="#rfc-2119" id="id1">[RFC-2119]</a>.</p>
<table class="docutils citation" frame="void" id="rfc-2119" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[RFC-2119]</a></td><td><a class="reference external" href="https://www.ietf.org/rfc/rfc2119.txt">https://www.ietf.org/rfc/rfc2119.txt</a></td></tr>
</tbody>
</table>
<p>NOTE: The .rst version of this document SHALL be considered the canonical version, the .pdf is merely a convenience.
Discrepancies MUST resolve to the .rst version.</p>
</div>
<div class="section" id="radio-frequency-identification">
<h2><a class="toc-backref" href="#id4">1.2&nbsp;&nbsp;&nbsp;Radio-frequency identification</a></h2>
<p>Radio-frequency identification (RFID) is a wireless communication scheme where a Reader transmits a strong signal towards a device (Tag) and the Tag responds by sending back data.
This communication from the Tag to Reader is accomplished by the Tag varying the impedance of its antenna.
The energy impinging on the Tag‚Äôs antenna is absorbed and reflected (‚Äúscattered‚Äù) in some proportion depending on the antenna‚Äôs impedance characteristics.</p>
<p>If the Tag changes its antenna impedance rapidly, the back-scattered energy will change also, resulting in the scattered wave having double-sideband modulation components in addition to the original frequency.
The Reader can detect these sidebands and demodulate the data that the Tag sent.</p>
<p>The most common method for modulating these back-scattered sidebands is to vary the frequency of the impedance changes between two frequencies.
Bits are therefore able to be assigned to each unique frequency.
In other words, the Tag switches the antenna impedance between two levels (usually open- / short-circuit) at frequency #1 or frequency #2 depending on the current bit to be sent.</p>
<p>Such a communication method requires extremely little power consumption on the Tag side of the link.
With careful design, the Tag can even extract enough energy from the incoming signal from the Reader to power itself and operate the antenna switch.</p>
</div>
<div class="section" id="synchronous-serial-communication">
<h2><a class="toc-backref" href="#id5">1.3&nbsp;&nbsp;&nbsp;Synchronous Serial Communication</a></h2>
<p>The two most common interfaces to connect peripheral devices to a central processor both use serial data connections, SPI and I2C.
It is possible, and even somewhat common, to find devices which are compatible with both formats using the same pins.</p>
<ul class="simple">
<li>SPI : Serial Peripheral Interface bus</li>
<li>I2C : Inter-Integrated-Circuit bus</li>
</ul>
<p>The details and timing diagrams for each of these formats are easily found on the internet.</p>
</div>
</div>
<div class="section" id="project-specifications">
<h1><a class="toc-backref" href="#id6">2&nbsp;&nbsp;&nbsp;Project Specifications</a></h1>
<p>The project for ECE 429 is to design and layout an integrated circuit in the On Semiconductor C5N 0.5um CMOS process that implements the major subsystems of an RFID tag.
A complete design would be capable of transmitting arbitrary data on programmable backscatter channel frequencies in the 915 MHz ISM band and also possibly in the 2.4 GHz ISM band.</p>
<div class="section" id="processor-interface-specification">
<h2><a class="toc-backref" href="#id7">2.1&nbsp;&nbsp;&nbsp;Processor interface specification</a></h2>
<p>The processor interface to this chip SHALL be via an SPI slave port.
From the view of the processor, the SPI port is viewed as an <strong>N</strong>-bit shift register.
Updating any bit of the device's configuration requires sending the entire <strong>N</strong>-bit set of data in a single bus transaction.</p>
<p>Pins participating in the SPI interface SHALL be named:</p>
<blockquote>
<ul class="simple">
<li><em>SCLK</em></li>
<li><em>MOSI</em></li>
<li><em>MISO</em></li>
<li><em>CS</em></li>
</ul>
</blockquote>
<p>The chip datasheet SHALL clearly specify the SPI mode in terms of <tt class="docutils literal">CPOL</tt> and <tt class="docutils literal">CPHA</tt> as used in reference [WP-SPI].</p>
<table class="docutils citation" frame="void" id="wp-spi" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[WP-SPI]</td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">https://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus</a></td></tr>
</tbody>
</table>
<p>Data SHALL transferred beginning with the most-significant bit of the entire bit string.
Data being returned from the slave to the master SHALL be shifted out of at the same time, also beginning with the <em>msb</em>.</p>
<p>Data bits that are applied to internal circuitry such as the NCO and DataOut register SHALL NOT change until the rising edge of the chip's <em>CS</em> pin.</p>
<p>Example of a transaction:</p>
<blockquote>
<ol class="arabic simple">
<li>The Master initiates a bus transaction and shifts out the <strong>N</strong>-bit data string <tt class="docutils literal"><span class="pre">data0[N-1:0]</span></tt> most-significant bit first to the slave on the <tt class="docutils literal">MOSI</tt> pin.
The slave shifts out the current state of the data string on the <tt class="docutils literal">MISO</tt> pin, also most-significant bit first.<ul>
<li>After the rising edge of the <em>CS</em> pin, the Master will have received <strong>N</strong>-bits of data from the slave.</li>
</ul>
</li>
<li>The Master initiates a second bus transaction and shifts out the <strong>N</strong>-bit data string <tt class="docutils literal"><span class="pre">data1[N-1:0]</span></tt> most-significant bit first to the slave on the <tt class="docutils literal">MOSI</tt> pin.
The slave shifts out the current state of the data string on the <tt class="docutils literal">MISO</tt> pin, also most-significant bit first.<ul>
<li>After the transaction, the Master will have again received <strong>N</strong>-bits of data from the slave.</li>
<li>This data MUST be identical to <tt class="docutils literal"><span class="pre">data0[N-1:0]</span></tt>.</li>
</ul>
</li>
</ol>
</blockquote>
<p>A consequence of this protocol definition is that the Slave behaves as a write-only device.
The Slave SHALL NOT send data back to the Master other than the data received from the Master in the previous bus transaction.</p>
<p>An asynchronous and active-low <em>reset</em> pin SHALL be provided by the chip.
At the falling edge of the <em>reset</em> pin, every register and flip-flop SHALL immediately set their <em>Q</em> outputs to a default value immediately.
This default register output state SHALL be clearly documented in the chip datasheet for EVERY register and EVERY flip-flop.</p>
<p>While the <em>reset</em> pin is low, every register MUST continually output the default state and ignore all input signals or clocks.
After the rising edge of the <em>reset</em> pin, the chip SHALL resume normal operation.</p>
<!-- The processor interface to this chip SHALL be via an SPI slave port.
From the view of the controlling processor, the device is a bank of up to 128 registers of 8-bits each which may be written to or read from.
The chip datasheet MUST specify the implemented address locations and the meaning of reads and/or writes to those addresses.
Writes to an unimplemented address SHOULD have no effect.
Reads of unimplemented register addresses MAY return meaningless data and SHOULD be ignored by the controlling processor. -->
<!-- The chip datasheet SHALL clearly specify the SPI mode in terms of ``CPOL`` and ``CPHA`` as used in reference [WP-SPI]. -->
<!-- .. [WP-SPI] https://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus -->
<!-- There SHALL be two commands accepted by the device: *read-register* and
*write-register*.
For an SPI bus transaction, these commands are encoded in the first and
most-significant bit of the first byte sent to the chip.
*Read-register* is encoded as a ``1`` while *write-register* is encoded as a
``0`` value.
The following two tables describe the protocol used for register read and write
commands. -->
<!-- .. table:: SPI register write transaction.  ``Raddr`` is the 7-bit register address and ``Rdata`` is the 8-bit register data to be stored. -->
<!-- ============  ====================  ======================
Pin              byte0              byte1
============  ====================  ======================
Bit #:          ``76543210``        ``76543210``
``MOSI``       ``0[Raddr]``         ``[Rdata ]``
``MISO``       ``xxxxxxxx``         ``xxxxxxxx``
============  ====================  ====================== -->
<!-- .. table:: SPI register read transaction.  ``Raddr`` is the 7-bit register address and ``Rdata`` is the 8-bit register data stored at that address. -->
<!-- ============  ====================  ======================
Pin              byte0              byte1
============  ====================  ======================
Bit #:          ``76543210``        ``76543210``
``MOSI``       ``1[Raddr]``         ``xxxxxxxx``
``MISO``       ``xxxxxxxx``         ``[Rdata ]``
============  ====================  ====================== -->
<!-- Implementation of a serial data interface compatible with both SPI and I2C is
OPTIONAL. -->
<!-- The chip's I2C device address MUST be within the range of valid addresses according to the I2C specification.
The least-significant bits of the address MAY be pin-programmable, i.e. zero or more pins MAY be used to set the last address bits while the prefix bits are hard-coded to some valid value. -->
<!-- Register read or write commands SHALL follow the same format as the SPI-based
protocol except the first byte is the I2C standard device address and
read/write bit.
Since the *read* or *write* command is specified in the least-significant bit
of the first transaction byte, the chip SHALL ignore the most-significant bit
of the register address byte.
The following tables describe the chip's 3-byte I2C protocol. -->
<!-- .. table:: I2C register write -->
<!-- ============  ====================  ======================  =============
Pin              byte0                   byte1               byte2
============  ====================  ======================  =============
Bit #:          ``76543210``        ``76543210``            ``76543210``
``SDA``         ``<Daddr>0``        ``x<Raddr>``            ``<8-data>``
============  ====================  ======================  ============= -->
<!-- .. table:: I2C register read -->
<!-- ============  ====================  ======================  =============
Pin              byte0                   byte1               byte2
============  ====================  ======================  =============
Bit #:          ``76543210``        ``76543210``            ``76543210``
``SDA``         ``<Daddr>1``        ``x<Raddr>``            ``<8-data>``
============  ====================  ======================  ============= -->
<div class="section" id="protocol-references">
<h3><a class="toc-backref" href="#id8">2.1.1&nbsp;&nbsp;&nbsp;Protocol references</a></h3>
<blockquote>
<p><a class="reference external" href="https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi">https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi</a></p>
<p><a class="reference external" href="http://www.i2cchip.com/mix_spi_i2c.html">http://www.i2cchip.com/mix_spi_i2c.html</a></p>
</blockquote>
<!-- http://www.nxp.com/documents/user_manual/UM10204.pdf -->
<!-- https://learn.sparkfun.com/tutorials/i2c -->
<!-- http://www.i2c-bus.org/ -->
<p>Other links:</p>
<blockquote>
<p><a class="reference external" href="http://wavedrom.com/">http://wavedrom.com/</a></p>
<p><a class="reference external" href="http://www.timing-diagrams.com/">http://www.timing-diagrams.com/</a></p>
</blockquote>
</div>
</div>
<div class="section" id="subsystem-interconnection">
<h2><a class="toc-backref" href="#id9">2.2&nbsp;&nbsp;&nbsp;Subsystem Interconnection</a></h2>
<div class="figure">
<img alt="fig/system-block.png" src="fig/system-block.png" style="width: 100%;" />
<p class="caption">Data Controller input and output signals.</p>
</div>
</div>
<div class="section" id="data-transmit-controller">
<h2><a class="toc-backref" href="#id10">2.3&nbsp;&nbsp;&nbsp;Data Transmit Controller</a></h2>
<p>This block SHALL accept an input data vector and configuration from the SPI interface and coordinate the sending of those bits to the modulation system made up of the NCO and switch mapper.</p>
<p>At the rising edge of <em>load</em> the current value of the <em>data[127:0]</em> configuration vector SHALL be captured into an internal 128-bit register.
This internal 128-bit register SHALL be used for shifting out the data.</p>
<p>A data packet transmission SHALL begin on the first rising edge of the <em>symclk</em> signal after a rising edge on the <em>start</em> signal.
The <em>start</em> signal SHALL remain high until the next rising edge of <em>symclk</em> which starts a packet transmission.
This timing constraint on the <em>start</em> signal MUST be clearly documented in the chip datasheet.</p>
<div class="sidebar">
<p class="first sidebar-title">OPTIONAL advanced specification for the previous paragraph.</p>
<p class="sidebar-subtitle">Fast to slow clock domain pulse synchronization</p>
<p>Background: The <em>start</em> signal is synchronized in the <em>clk</em> clock domain (that of the NCO) but the Data Transmit Controller operates in the <em>symclk</em> clock domain.
Fortunately, <em>symclk</em> is derived from <em>clk</em> via an NCO and is therefore synchronous with the <em>clk</em> clock domain.</p>
<p>---</p>
<p class="last">Alternate specification for <em>start</em> high time:
A data packet transmission SHALL begin on the first rising edge of the <em>symclk</em> signal after a rising edge on the <em>start</em> signal.
The minimum high time of the <em>start</em> signal SHALL be one <em>clk</em> signal period.
It is NOT REQUIRED that <em>start</em> remain high until the next rising edge of <em>symclk</em>.
This timing constraint on the <em>start</em> signal MUST be clearly documented in the chip datasheet.</p>
</div>
<p>The <em>tx</em> output signal SHALL go high at the first edge of <em>symclk</em> after <em>start</em> goes high.
Signal <em>tx</em> SHALL remain high for the number of <em>symclk</em> periods contained in the value of the input configuration signal <em>nbits[7:0]</em> and then <em>tx</em> SHALL return low.</p>
<p>The internal 128-bit register SHALL perform a circular shift operation with the <em>reg[127]</em> flip-flop output connected to the <em>reg[0]</em> flip-flop's D input.
After 128 <em>symclk</em> pulses after starting a transmission triggered by <em>start</em>, the register MUST stop shifting if <em>start</em> is low.
The register SHALL contain the same data in the same order as was loaded on the last rising edge of <em>load</em>.
The net effect of this is to allow repeated transmission of the same data packet without requiring a repeated SPI transaction with identical contents.</p>
<p>The next data transmission SHALL NOT start until at least 128 periods of the <em>symclk</em> signal.
If there has not been another rising edge of <em>load</em>, a next rising edge of <em>start</em> SHALL initiate another data transmission with the same contents as the previous transmission cycle.
If <em>start</em> remains high by the end of a packet transmission cycle, another packet transmission SHALL start on the next edge of <em>symclk</em>.
This edge is the 129th edge counting from the first <em>symclk</em> edge after the original rising edge of <em>start</em>.</p>
<p>When input <tt class="docutils literal">mode = 0</tt>, the contents of the internal data register are shifted out at each rising edge of <em>symclk</em> beginning with the most-significant bit.
This signal SHALL appear at output pin <em>fsel</em>.</p>
<p>Output pin <em>fsel</em> SHALL be the same as the current b</p>
<p>This block operates in two modes,depending on the state of the <em>mode</em> signal.
When <tt class="docutils literal">mode = 0</tt> and the signal <em>transmit</em> is <tt class="docutils literal">1</tt>, block shifts out the contents of the <em>data[M-1:0]</em> register to its output pin <em>symbol[0]</em> at each rising edged of the <em>symclk</em> signal.
Pin <em>symbol[1]</em> remains <tt class="docutils literal">0</tt> in this mode.</p>
<div class="figure">
<img alt="fig/data-controller.png" src="fig/data-controller.png" style="width: 340pt;" />
<p class="caption">Data Controller input and output signals.</p>
</div>
<!-- /*
This block is how to get a live-rendered WaveDrom image in the HTML
version and a corresponding image in the TEX/PDF version.  In
cooperation with "fig/Makefile", export the image rendered in the HTML
version as SVG and place under the same name as the JSON version.  The
Makefile will call Inkscape to generate a PDF for display in the pdfTEX
output. -->
<script type="WaveDrom">// Timing diagram for sending 6 bits of an 8-bit data vector
{signal: [
  ['Outputs',
   	['',
     {name: 'sym[0]', wave: '0.2222220..', data:'d[7] d[6] d[5] d[4] d[3] d[2]'},
     	{name: 'sym[0]', wave: '0.1.0..10..'},
    ],
  	{name: 'tx',     wave: '0.1.....0..'},
  ],
  ['Inputs',
  	{name: 'symclk', wave: 'P..........'},
  	{name: 'data[7:0]', wave: '2.x........', data: '0xC5'},
  	{name: 'nbits[3:0]', wave: '2.x........', data: '0x6'},
  	{name: 'start',  wave: '01.........'},
  	{name: 'mode',   wave: '0..........'},
  ],
  ],
  foot: {tock: -1,},
 }
</script><div class="figure">
<img alt="fig/timing-datactl-mode0" src="fig/timing-datactl-mode0" />
<p class="caption">Timing diagram for sending the top 6 bits of an 8-bit data vector.
<strong>NOTE:</strong> this is only an example, using data vector of 8-bits only, the project uses a data vector of 128 bits in length.</p>
</div>
<!-- </end> block for timing diagrams
*/ -->
<p>** <em>TODO</em> ** <tt class="docutils literal">mode = 1</tt> description</p>
</div>
<div class="section" id="numerically-controlled-oscillator-nco">
<h2><a class="toc-backref" href="#id11">2.4&nbsp;&nbsp;&nbsp;Numerically-controlled oscillator (NCO)</a></h2>
<p>A numerically-controlled oscillator forms the basis of the programmable backscatter frequency control for both channel selection and frequency-shift-keying (FSK) modulation.
The NCO SHALL use an 8-bit frequency control word <em>fcw[7:0]</em>.
The current state of the phase accumulator register and <em>fcw[7:0]</em> SHALL be added, ignoring the carry-out, and used to set the next state of the phase accumulator register.
This causes the accumulator to increment its state by the value of <em>fcw</em> at each clock cycle.</p>
<div class="figure">
<img alt="fig/nco-block.png" src="fig/nco-block.png" style="width: 340pt;" />
<p class="caption">Numerically-controlled oscillator block with input and output signals.</p>
</div>
<div class="figure">
<img alt="fig/nco.png" src="fig/nco.png" style="width: 340pt;" />
<p class="caption">Numerically-controlled oscillator internal construction.</p>
</div>
<p>Only the most-significant bit of the phase accumulator SHALL used as the output signal.
This <em>out</em> signal is a square wave at an average frequency of:</p>
<div class="formula">
<i>f</i><sub><i>out</i></sub>‚ÄÖ=‚ÄÖ<span class="fullfraction"><span class="ignored">(</span><span class="numerator"><i>fcw</i></span><span class="ignored">)/(</span><span class="denominator">256</span><span class="ignored">)</span></span><i>f</i><sub><i>clk</i></sub>
</div>
<p>The smallest change in average output frequency for the NCO is given by:</p>
<div class="formula">
<i>f</i><sub><i>res</i></sub>‚ÄÖ=‚ÄÖ<span class="fullfraction"><span class="ignored">(</span><span class="numerator"><i>f</i><sub><i>clk</i></sub></span><span class="ignored">)/(</span><span class="denominator">256</span><span class="ignored">)</span></span>
</div>
<p>The duty cycle is not guaranteed to be 50% -- the high and low times may vary by ¬± 1 clock period.
See reference [WP-NCO] for more information about NCO output characteristics.</p>
<table class="docutils citation" frame="void" id="wp-nco" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[WP-NCO]</td><td><a class="reference external" href="https://en.wikipedia.org/wiki/Numerically_controlled_oscillator">https://en.wikipedia.org/wiki/Numerically_controlled_oscillator</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="symbol-rate-clock-generator">
<h2><a class="toc-backref" href="#id12">2.5&nbsp;&nbsp;&nbsp;Symbol rate clock generator</a></h2>
<p>This block SHALL be a second instance of the NCO.
Both NCOs SHALL be clocked from the same source and therefore operate in the same clock domain <em>clk</em>.</p>
<p>The 8-bit frequency control word for this NCO SHALL be provided from a separate 8-bit sub-vector of the SPI configuration data.
The output signal of this block SHALL be named <em>symclk</em> and is the source of the signal when referred to in other parts of this document.</p>
</div>
<div class="section" id="frequency-control-word-multiplexer">
<h2><a class="toc-backref" href="#id13">2.6&nbsp;&nbsp;&nbsp;Frequency Control Word multiplexer</a></h2>
<p>In order to implement frequency-shift keying (FSK) modulation, the NCO must have its <em>fcw</em> toggled between two values.
A multiplexer SHALL switch its output between two 8-bit values <em>in0[7:0]</em> and <em>in1[7:0]</em> according to the state of input signal <em>sel</em>.
When <tt class="docutils literal">sel = 0</tt>, the <em>in0</em> vector SHALL be passed to the output.
When <tt class="docutils literal">sel = 1</tt>, the <em>in1</em> vector SHALL be passed to the output.</p>
<p>All input signals to the multiplexer, <em>in0</em>, <em>in1</em>, and <em>sel</em> MUST be synchronized by the same clock used to drive the NCO.</p>
<div class="figure">
<img alt="fig/mux-8x2.png" src="fig/mux-8x2.png" style="width: 340pt;" />
<p class="caption">8-bit multiplexer to select between two input control words to apply to the NCO's <em>fcw</em> input port.</p>
</div>
</div>
<div class="section" id="switch-mapper">
<h2><a class="toc-backref" href="#id14">2.7&nbsp;&nbsp;&nbsp;Switch mapper</a></h2>
<p>The switch mapper translates the mode of operation (FSK, or QAM) into appropriate antenna switch states.
Switch states are translated as <tt class="docutils literal">switch[x] = 0</tt>: NMOS off, and <tt class="docutils literal">switch[x] == 1</tt>: NMOS on.</p>
<p>In FSK mode (<tt class="docutils literal">mode == 0</tt>), the input <em>fmod</em> is directly passed to <tt class="docutils literal">switch[0]</tt> while the other switches remain off.
For QAM mode (<tt class="docutils literal">mode == 1</tt>), the 2-bit input <em>symbol[1:0]</em> determines which single switch is on and the <em>fmod</em> input is ignored.</p>
<div class="figure">
<img alt="fig/sym-switch.png" src="fig/sym-switch.png" style="width: 340pt;" />
<p class="caption">Switch state mapping block diagram.  See the table &quot;Symbol to antenna switch mapping table&quot; for the decoding.</p>
</div>
<table border="1" class="docutils">
<caption>Symbol to antenna switch mapping table.</caption>
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">mode</th>
<th class="head">tx</th>
<th class="head">fmod</th>
<th class="head">symbol[1:0]</th>
<th class="head">switch[2:0]</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal">0</tt></td>
<td><tt class="docutils literal">0</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">XX</tt></td>
<td><tt class="docutils literal">000</tt></td>
</tr>
<tr><td><tt class="docutils literal">0</tt></td>
<td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">0</tt></td>
<td><tt class="docutils literal">XX</tt></td>
<td><tt class="docutils literal">000</tt></td>
</tr>
<tr><td><tt class="docutils literal">0</tt></td>
<td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">XX</tt></td>
<td><tt class="docutils literal">001</tt></td>
</tr>
<tr><td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">00</tt></td>
<td><tt class="docutils literal">000</tt></td>
</tr>
<tr><td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">01</tt></td>
<td><tt class="docutils literal">001</tt></td>
</tr>
<tr><td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">10</tt></td>
<td><tt class="docutils literal">010</tt></td>
</tr>
<tr><td><tt class="docutils literal">1</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">X</tt></td>
<td><tt class="docutils literal">11</tt></td>
<td><tt class="docutils literal">100</tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="antenna-switches">
<h2><a class="toc-backref" href="#id15">2.8&nbsp;&nbsp;&nbsp;Antenna switches</a></h2>
<p>These switch various impedances in parallel with the antenna to vary its net impedance and thence backscatter magnitude/phase.</p>
<p>Three N-type switches SHALL be have their gate terminals controlled by the signals <tt class="docutils literal">switch[2:0]</tt>.
The switches SHALL have their drain terminal directly connected to the <em>ANT</em> chip pin.
Each switch transistors <tt class="docutils literal">switch[2]</tt> and <tt class="docutils literal">switch[1]</tt> SHALL be connected to separate resistors <em>R2</em> and <em>R1</em> of different values.
Values for these resistors SHALL be determined through discussions with Professors White and Thomas.
These resistor values SHALL be documented in the chip datasheet.
The other terminal of the resistors SHALL be connected to node <em>antref</em> which SHALL also be connected to chip pin <em>ANTREF</em>.
The source terminal of the <tt class="docutils literal">switch[0]</tt> transistor SHALL be connected directly to the <em>antref</em> node.
Pin <em>ANTREF</em> SHALL be assumed to be nominally at the system's lowest voltage, but the pin SHALL NOT be connected internally to any other &quot;ground-like&quot; node.</p>
</div>
<div class="section" id="charge-pump">
<h2><a class="toc-backref" href="#id16">2.9&nbsp;&nbsp;&nbsp;Charge pump</a></h2>
<p>Accepts antenna input and outputs semi-regulated DC.</p>
</div>
</div>
</div>
</body>
</html>
